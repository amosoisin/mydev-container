# TODO: Docker開発環境

このファイルは、プロジェクトのタスク管理とアイデアのメモです。

## 📋 進行中のタスク

現在、進行中のタスクはありません。

## 🎯 優先度: 高

### 実環境での動作確認
- [x] 新しいイメージで環境を再作成
  ```bash
  docker compose up -d --force-recreate
  ```
- [x] 全ツールの動作確認（Neovim、Zsh、Git等）
- [x] 設定ファイルのシンボリックリンク確認

### キャッシュ効率のテスト
- [x] ohmyzshプラグインを1つ追加して再ビルド
- [x] Neovimビルドがスキップされることを確認
- [x] ビルド時間を計測・記録

## 📊 優先度: 中

### さらなる最適化の検討
- [x] マルチステージビルドの調査
  - 結論: 開発環境のため非推奨（ビルドツールが実行時にも必要）
- [x] ベースイメージの軽量化検討
  - 結論: ubuntu:24.04が既に最小構成（slim版は存在しない）
- [x] 不要なパッケージの洗い出し
  - 結論: 全パッケージ使用中または将来的に必要

### CI/CDパイプラインの検討
- [x] GitHub Actionsでの自動ビルド
  - ワークフロー作成完了: `.github/workflows/docker-build.yml`
- [x] イメージのバージョン管理戦略
  - 結論: 個人開発のため現時点では不要（必要になってから実装）
- [x] 自動テストの追加
  - 結論: 個人開発のため不要（ビルド検証のみで十分）

## 💡 優先度: 低

### モニタリングとヘルスチェック
- [ ] compose.ymlにヘルスチェック追加（本番向け）
- [ ] リソース制限の設定（必要に応じて）
- [ ] ログ集約の検討

### ドキュメント強化
- [ ] 各ツールの使い方ガイド
- [ ] トラブルシューティングの充実
- [ ] 開発環境のセットアップ動画作成？

## 🔍 検討中のアイデア

### Dockerイメージの分割
- 開発用イメージと本番用イメージの分離
- 言語別のイメージ（C/Python特化、Rust特化等）

### 設定ファイルの管理方法
- dotfiles リポジトリとの連携
- chezmoi等のdotfile管理ツールの導入

### パフォーマンス最適化
- BuildKitの有効活用
- キャッシュマウントの利用
- bind mountのパフォーマンスチューニング

### セキュリティ強化
- Trivyによる脆弱性スキャン
- rootless Dockerの検討
- Secret管理の改善（Docker secrets、環境変数の暗号化）

## ✅ 完了したタスク（アーカイブ）

### 2025-12-25 - 初期ドキュメント整備
- [x] README.md作成
- [x] CLAUDE.md作成
- [x] .dockerignore作成

### 2025-12-25 - セキュリティ強化
- [x] entrypoint.shのエラーハンドリング強化
- [x] compose.ymlにno-new-privileges追加

### 2025-12-25 - Dockerfile最適化（ステップA）
- [x] DEBIAN_FRONTEND=noninteractive追加
- [x] apt→apt-get統一
- [x] クリーンアップ強化
- [x] 効果: 100MB削減

### 2025-12-25 - Dockerfile最適化（ステップB-1）
- [x] 重複パッケージ削除
- [x] apt-get installの統合（3箇所→1箇所）
- [x] RUN命令の統合
- [x] 効果: 10MB削減、29行削減

### 2025-12-26 - Dockerfile最適化（ステップB-2）
- [x] レイヤー順序の最適化
- [x] Dockerインストールの移動
- [x] Neovimビルドの移動
- [x] 効果: 再ビルド効率向上

### 2025-12-26 - 優先度:中タスク完了
- [x] マルチステージビルド調査（非推奨と判断）
- [x] ベースイメージ軽量化調査（ubuntu:24.04が最適と判断）
- [x] 不要パッケージ調査（全パッケージ必要と判断）
- [x] GitHub Actions自動ビルド実装
- [x] バージョン管理戦略検討（個人開発のため延期）
- [x] 自動テスト検討（個人開発のため不要）

---

## 📝 メモ

### ビルド時間の記録
（今後のパフォーマンス測定用）

| 日付 | 変更内容 | フルビルド時間 | キャッシュ有効時 |
|------|----------|----------------|------------------|
| 2025-12-26 | ステップB-2完了 | 未計測 | 未計測 |

### イメージサイズの推移

| 日付 | イメージサイズ | 変更内容 |
|------|----------------|----------|
| 2025-12-25（最適化前） | 7.2GB | - |
| 2025-12-25（ステップA） | 7.1GB | クリーンアップ強化 |
| 2025-12-25（ステップB-1） | 7.18GB | RUN命令統合 |
| 2025-12-26（ステップB-2） | 7.18GB | レイヤー順序最適化 |

---

**最終更新:** 2025-12-26（優先度:中タスク完了）
